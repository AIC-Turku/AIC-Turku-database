# ðŸ“Š {{ instrument.display_name }} Â· History

<div class="aic-topactions" markdown="span">
  [ðŸ”™ Back to Overview](index.md){ .md-button }
</div>

## ðŸ“ˆ Metrics Over Time

<div id="chartsContainer" class="aic-chartgrid"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const chartsData = {{ charts_json }};
  const metricNames = {{ metric_names | tojson | safe }};
  const container = document.getElementById('chartsContainer');
  
  if (!container || !window.Chart) return;
  
  const chartKeys = Object.keys(chartsData);
  if (chartKeys.length === 0) {
    container.innerHTML = '<p class="aic-muted">No historical metrics available.</p>';
    return;
  }

  const themeColor = 'var(--md-typeset-a-color, #4051b5)';

  for (const [metricId, chartConfig] of Object.entries(chartsData)) {
    const readableTitle = metricNames[metricId] || metricId;

    const wrapper = document.createElement('div');
    wrapper.className = 'aic-chartcard';

    const title = document.createElement('div');
    title.className = 'aic-chartcard__title';
    title.textContent = readableTitle;
    wrapper.appendChild(title);

    const canvasContainer = document.createElement('div');
    canvasContainer.className = 'aic-chartcard__canvas-wrapper';
    
    const canvas = document.createElement('canvas');
    canvasContainer.appendChild(canvas);
    wrapper.appendChild(canvasContainer);
    container.appendChild(wrapper);

    new Chart(canvas, {
      type: 'line',
      data: {
        labels: chartConfig.labels,
        datasets: [{
          label: readableTitle,
          data: chartConfig.values,
          borderColor: themeColor,
          backgroundColor: 'transparent',
          pointBackgroundColor: themeColor,
          borderWidth: 2,
          pointRadius: 3,
          tension: 0.2,
          spanGaps: true
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: false } }
      }
    });
  }
});
</script>

## ðŸ“œ Event Timeline

{% set all_events = (qc_events | default([], true)) + (maintenance_events | default([], true)) %}
{% set sorted_events = all_events | sort(attribute='date', reverse=True) %}

{% if sorted_events %}
<div class="aic-timeline">
  {% for event in sorted_events %}
    {% set is_qc = event in qc_events %}
    {% set event_icon = 'ðŸ”¬' if is_qc else 'ðŸ”§' %}
    {% set event_label = 'QC Session' if is_qc else 'Maintenance' %}
    {% set event_class = 'aic-timeline__event--qc' if is_qc else 'aic-timeline__event--maint' %}
    
    <div class="aic-timeline__event {{ event_class }}">
      <div class="aic-timeline__marker" title="{{ event_label }}">{{ event_icon }}</div>
      
      <div class="aic-card aic-timeline__content">
        <div class="aic-timeline__header">
          <div>
            <strong>{{ event.date | default('Unknown Date', true) }}</strong>
            <span class="aic-muted" style="margin-left: 0.5rem; font-size: 0.85rem;">{{ event_label }}</span>
          </div>
          <span class="aic-badge">{{ event.status | default('â€”', true) | upper }}</span>
        </div>
        
        <div class="aic-timeline__body">
          {{ event.suite | default(event.type, true) | default('Routine Event', true) }}
        </div>
        
        <div class="aic-timeline__actions" markdown="span">
          <a href="../../events/{{ event.event_id }}.md" class="md-button md-button--small">View Full Report</a>
        </div>
      </div>
    </div>
  {% endfor %}
</div>
{% else %}
> ðŸ“­ *No QC or Maintenance events recorded yet.*
{% endif %}
