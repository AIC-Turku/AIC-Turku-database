# {{ instrument.display_name }} Â· History

<div class="aic-topactions" markdown="span">
  [ðŸ”™ Back to Overview](index.md){ .md-button }
</div>

## Latest Metric Snapshot

| Metric | Latest Value |
|---|---|
{% for metric_id, value in latest_metrics.items() -%}
| **{{ metric_names.get(metric_id, metric_id) }}** <br><span class="aic-muted"><code>{{ metric_id }}</code></span> | <code>{{ value | default('â€”', true) }}</code> |
{% else -%}
| â€” | â€” |
{% endfor %}

## Metrics Over Time

<div id="chartsContainer" class="aic-chartgrid"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const chartsData = {{ charts_json }};
  const metricNames = {{ metric_names | tojson | safe }};
  const container = document.getElementById('chartsContainer');
  
  if (!container || !window.Chart) return;
  
  const chartKeys = Object.keys(chartsData);
  if (chartKeys.length === 0) {
    container.innerHTML = '<p class="aic-muted">No historical metrics available.</p>';
    return;
  }

  // Use MkDocs Material theme colors for charts
  const themeColor = 'var(--md-typeset-a-color, #4051b5)';

  for (const [metricId, chartConfig] of Object.entries(chartsData)) {
    const readableTitle = metricNames[metricId] || metricId;

    const wrapper = document.createElement('div');
    wrapper.className = 'aic-chartcard';

    const title = document.createElement('div');
    title.className = 'aic-chartcard__title';
    title.textContent = readableTitle;
    wrapper.appendChild(title);

    const canvasContainer = document.createElement('div');
    canvasContainer.className = 'aic-chartcard__canvas-wrapper';
    
    const canvas = document.createElement('canvas');
    canvasContainer.appendChild(canvas);
    wrapper.appendChild(canvasContainer);
    container.appendChild(wrapper);

    // FIXED: Reconstruct the strict dataset object Chart.js requires
    new Chart(canvas, {
      type: 'line',
      data: {
        labels: chartConfig.labels,
        datasets: [{
          label: readableTitle,
          data: chartConfig.values,
          borderColor: themeColor,
          backgroundColor: 'transparent',
          pointBackgroundColor: themeColor,
          borderWidth: 2,
          pointRadius: 3,
          tension: 0.2,
          spanGaps: true
        }]
      },
      options: {
        responsive: true,
        plugins: { 
          legend: { display: false } 
        },
        scales: { 
          y: { beginAtZero: false } 
        }
      }
    });
  }
});
</script>

## Event Log

### QC Events

| Date | Suite/Type | Status |
|---|---|---|
{% for event in qc_events | reverse -%}
| [{{ event.date | default('Unknown', true) }}](../../events/{{ event.event_id }}.md) | {{ event.suite | default(event.type, true) | default('â€”', true) }} | `{{ event.status | default('â€”', true) | upper }}` |
{% else -%}
| â€” | â€” | â€” |
{% endfor %}

### Maintenance Events

| Date | Suite/Type | Status |
|---|---|---|
{% for event in maintenance_events | reverse -%}
| [{{ event.date | default('Unknown', true) }}](../../events/{{ event.event_id }}.md) | {{ event.suite | default(event.type, true) | default('â€”', true) }} | `{{ event.status | default('â€”', true) | upper }}` |
{% else -%}
| â€” | â€” | â€” |
{% endfor %}
