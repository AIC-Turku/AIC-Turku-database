---
hide:
  - toc
---

# Instrument Fleet Overview

!!! info "At-a-glance"
    **Total:** {{ counts.total }} · **Online:** {{ counts.green }} · **Warning:** {{ counts.yellow }} · **Offline:** {{ counts.red }}

<div class="aic-fleetbar">
  <div class="aic-fleetbar__group">
    <label class="aic-label" for="aicSearch">Search</label>
    <input id="aicSearch" class="aic-input" type="search" placeholder="Name, manufacturer, model…" />
  </div>

  <div class="aic-fleetbar__group">
    <label class="aic-label" for="aicModality">Modality</label>
    <select id="aicModality" class="aic-select">
      <option value="all">All</option>
      {% for mod in all_modalities %}
      <option value="{{ mod | lower }}">{{ mod }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="aic-fleetbar__spacer"></div>

  <div class="aic-fleetbar__group aic-fleetbar__hint" markdown="span">
    Tip: click a card to open the instrument page.
  </div>
</div>

<div class="aic-grid">
  {% for inst in instruments %}
  <a class="aic-card aic-card--link" href="instruments/{{ inst.id }}/index.md"
     data-name="{{ inst.display_name | lower }}"
     data-manufacturer="{{ inst.manufacturer | lower }}"
     data-model="{{ inst.model | lower }}"
     data-modalities="{{ inst.modalities | join(',') | lower }}"
     aria-label="Open {{ inst.display_name }}">

    <div class="aic-card__media">
      <img src="assets/images/{{ inst.image_filename }}" alt="{{ inst.display_name }}"
           onerror="this.onerror=null; this.src='assets/images/placeholder.svg';" />
      <div class="aic-badge aic-badge--{{ inst.status.color }}">{{ inst.status.badge }}</div>
    </div>

    <div class="aic-card__body">
      <div class="aic-card__title">{{ inst.display_name }}</div>
      <div class="aic-card__meta">{{ inst.manufacturer }}{% if inst.model %} · {{ inst.model }}{% endif %}</div>

      <div class="aic-chiprow">
        {% for mod in inst.modalities[:4] %}
          <span class="aic-chip">{{ mod }}</span>
        {% endfor %}
        {% if inst.modalities | length > 4 %}
          <span class="aic-chip aic-chip--muted">+{{ (inst.modalities | length) - 4 }}</span>
        {% endif %}
      </div>
    </div>

  </a>
  {% endfor %}
</div>

<script>
(function() {
  const modalityEl = document.getElementById('aicModality');
  const searchEl = document.getElementById('aicSearch');
  const cards = Array.from(document.querySelectorAll('.aic-card'));

  function applyFilters() {
    const mod = (modalityEl.value || 'all').toLowerCase();
    const q = (searchEl.value || '').trim().toLowerCase();

    cards.forEach(card => {
      // FIXED: Split string into array for exact matching to prevent substring false-positives
      const cardModsStr = card.getAttribute('data-modalities') || '';
      const cardModsList = cardModsStr ? cardModsStr.split(',').map(s => s.trim()) : [];
      
      const hay = [
        card.getAttribute('data-name') || '',
        card.getAttribute('data-manufacturer') || '',
        card.getAttribute('data-model') || ''
      ].join(' ');

      const matchesMod = (mod === 'all') || cardModsList.includes(mod);
      const matchesQ = (!q) || hay.includes(q);
      
      card.style.display = (matchesMod && matchesQ) ? '' : 'none';
    });
  }

  modalityEl.addEventListener('change', applyFilters);
  searchEl.addEventListener('input', applyFilters);
})();
</script>
