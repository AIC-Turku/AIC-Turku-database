# {{ instrument.display_name }}

[ðŸ“ˆ History & logs](history.md){ .md-button .md-button--primary }

{% set level = 'success' if instrument.status.color == 'green' else 'warning' if instrument.status.color == 'yellow' else 'danger' %}
!!! {{ level }} "Status: {{ instrument.status.badge }}"
    **Reason:** {{ instrument.status.reason }}  
    **Last QC:** {{ instrument.status.last_qc_date | default('â€”', true) }} Â· **Last maintenance:** {{ instrument.status.last_maint_date | default('â€”', true) }}

<div class="aic-hero">
  <div>
    <img
      class="aic-img"
      src="../../assets/images/{{ instrument.image_filename }}"
      alt="{{ instrument.display_name }}"
      onerror="this.onerror=null; this.src='../../assets/images/placeholder.svg';"
    />
  </div>

  <div class="aic-panel">
    <div class="aic-inline" style="justify-content: space-between;">
      <div class="aic-inline">
        <span class="aic-chip aic-chip--status aic-chip--{{ instrument.status.color }}" title="{{ instrument.status.reason }}">{{ instrument.status.badge }}</span>
        {% if instrument.instrument_id %}<span class="aic-chip" title="Stable routing ID">{{ instrument.instrument_id }}</span>{% endif %}
      </div>
      {% if instrument.booking_url %}
      <a class="md-button" href="{{ instrument.booking_url }}" target="_blank" rel="noopener">Book / access</a>
      {% endif %}
    </div>

    <div class="aic-kv" style="margin-top: .75rem;">
      <div>Manufacturer</div><div>{{ instrument.manufacturer | default('â€”', true) }}</div>
      <div>Model</div><div>{{ instrument.model | default('â€”', true) }}</div>
      <div>Stand</div><div>{{ instrument.stand_orientation | default('â€”', true) }}</div>
      {% if instrument.location %}
      <div>Location</div><div>{{ instrument.location }}</div>
      {% endif %}
    </div>

    {% if instrument.notes %}
    <div style="margin-top: .85rem;" markdown="span">{{ instrument.notes }}</div>
    {% endif %}

    {% if instrument.contacts %}
    <div style="margin-top: .9rem;" class="aic-stack">
      <div><strong>Contacts</strong></div>
      <div class="aic-inline">
        {% for c in instrument.contacts %}
          <span class="aic-chip">{{ c }}</span>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
</div>

=== "Capabilities"

    <div class="aic-stack">
      <div>
        <strong>Modalities</strong>
        <div class="aic-inline" style="margin-top: .35rem;">
          {% for mod in instrument.modalities %}
          <span class="aic-chip">{{ mod }}</span>
          {% else %}
          <span class="aic-muted">No modalities tagged</span>
          {% endfor %}
        </div>
      </div>

      <div>
        <strong>Modules</strong>
        <div class="aic-inline" style="margin-top: .35rem;">
          {% for mod in instrument.modules %}
          <span class="aic-chip">{{ mod }}</span>
          {% else %}
          <span class="aic-muted">No modules tagged</span>
          {% endfor %}
        </div>
      </div>
    </div>

=== "Hardware"

    ### Light sources

    | Model | Kind | Wavelength (nm) | Manufacturer |
    |---|---|---:|---|
    {% for src in light_sources %}
    | {{ src.model | default('â€”', true) }} | {{ src.kind | default('â€”', true) }} | {{ src.wavelength_nm | default('â€”', true) }} | {{ src.manufacturer | default('â€”', true) }} |
    {% else %}
    | â€” | â€” | â€” | â€” |
    {% endfor %}

    ### Detectors

    | Model | Kind | Manufacturer |
    |---|---|---|
    {% for det in detectors %}
    | {{ det.model | default('â€”', true) }} | {{ det.kind | default('â€”', true) }} | {{ det.manufacturer | default('â€”', true) }} |
    {% else %}
    | â€” | â€” | â€” |
    {% endfor %}

    ### Objectives

    | Model | Mag | NA | Immersion | Manufacturer |
    |---|---:|---:|---|---|
    {% for obj in objectives %}
    | {{ obj.model | default('â€”', true) }} | {{ obj.magnification | default('â€”', true) }}Ã— | {{ obj.numerical_aperture | default('â€”', true) }} | {{ obj.immersion | default('â€”', true) }} | {{ obj.manufacturer | default('â€”', true) }} |
    {% else %}
    | â€” | â€” | â€” | â€” | â€” |
    {% endfor %}

=== "Software"

    {% if software %}
    | Component | Name | Version |
    |---|---|---|
    {% for sw in software %}
    | {{ sw.component }} | {{ sw.name | default('â€”', true) }} | {{ sw.version | default('â€”', true) }} |
    {% endfor %}
    {% else %}
    *No software recorded.*
    {% endif %}

=== "QC"

    #### Latest measurements

    | Metric | Value | Unit |
    |---|---:|---|
    {% for m in latest_metrics %}
    | {{ metric_names.get(m.metric_id, m.metric_id) }} <br><span class="aic-muted" style="font-size:.72rem;">`{{ m.metric_id }}`</span> | `{{ m.value }}` | {{ m.unit | default('â€”', true) }} |
    {% else %}
    | â€” | â€” | â€” |
    {% endfor %}

    {% if latest_qc_overall %}
    !!! info "Latest QC verdict"
        **Overall:** `{{ latest_qc_overall }}`
    {% endif %}

    #### Trends

    <div
      class="aic-charts"
      data-aic-charts='{{ charts_data | tojson | safe }}'
      data-aic-metric-names='{{ metric_names | tojson | safe }}'
    ></div>
