# {{ display_name }}

[ðŸ“Š View Full History & QC Logs](history.md){ .md-button .md-button--primary }

!!! {{ 'success' if status_indicator == 'ðŸŸ¢ Online' else 'warning' if status_indicator == 'ðŸŸ¡ Warning' else 'danger' }} "Current Status: {{ status_indicator }}"

<div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
    <div style="flex: 1; min-width: 300px;">
        <img src="../../assets/images/{{ instrument.image_filename }}" style="width: 100%; max-width: 400px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.src='../../assets/images/placeholder.png';" alt="{{ display_name }} image">
    </div>
    <div style="flex: 2; min-width: 300px;">
        <h3>System Capabilities</h3>
        <p><strong>Modalities:</strong><br>
        {% for mod in modalities %}
        <span style="display: inline-block; background: var(--md-primary-fg-color); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.85em; margin: 2px;">{{ mod }}</span>
        {% else %}
        <em>No modalities listed</em>
        {% endfor %}
        </p>
    </div>
</div>

## Software Environment
{% if software %}
| Software Name | Version | Type |
|---------------|---------|------|
{% for sw in software %}
| **{{ sw.name | default("-", true) }}** | `{{ sw.version | default("-", true) }}` | {{ sw.type | default("-", true) }} |
{% endfor %}
{% else %}
> *No software configurations recorded.*
{% endif %}

## Hardware Configurations

### Light Sources
| Name / Model | Type | Wavelength | Notes |
|--------------|------|------------|-------|
{% for src in light_sources %}
| **{{ src.name | default("-", true) }}** | {{ src.type | default("-", true) }} | `{{ src.wavelength | default("-", true) }}` | {{ src.notes | default("-", true) }} |
{% endfor %}

### Detectors
| Manufacturer | Model | Type | Notes |
|--------------|-------|------|-------|
{% for det in detectors %}
| **{{ det.name | default("-", true) }}** | {{ det.model | default("-", true) }} | {{ det.type | default("-", true) }} | {{ det.notes | default("-", true) }} |
{% endfor %}

### Objectives
| Name / Model | Magnification | N.A. | Notes |
|--------------|---------------|------|-------|
{% for obj in objectives %}
| **{{ obj.name | default("-", true) }}** | {{ obj.magnification | default("-", true) }}x | `{{ obj.na | default("-", true) }}` | {{ obj.notes | default("-", true) }} |
{% endfor %}

## QC Metrics Overview

### Latest Measurements
| Metric | Value |
|--------|-------|
{% for m_id, m_val in latest_metrics.items() %}
| **{{ metric_names.get(m_id, m_id) }}** <br><span style="font-size: 0.75em; color: gray;">(`{{ m_id }}`)</span> | `{{ m_val }}` |
{% else %}
| *No recent measurements* | - |
{% endfor %}

### Metric Trends

<div markdown="span">
<div id="chartsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    const chartsData = {{ charts_json }};
    const container = document.getElementById('chartsContainer');
    
    // Pass the python dictionary to JS for human-readable titles
    const metricNames = {{ metric_names | tojson | safe }};

    for (const [metricId, chartConfig] of Object.entries(chartsData)) {
        const readableTitle = metricNames[metricId] || metricId;
        
        const wrapper = document.createElement('div');
        wrapper.style.border = '1px solid var(--md-default-fg-color--lightest)';
        wrapper.style.padding = '10px';
        wrapper.style.borderRadius = '8px';
        wrapper.style.backgroundColor = 'var(--md-default-bg-color)';
        
        const canvas = document.createElement('canvas');
        wrapper.appendChild(canvas);
        container.appendChild(wrapper);

        new Chart(canvas, {
            type: 'line',
            data: chartConfig,
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: readableTitle, font: { size: 14 } }
                }
            }
        });
    }
});
</script>
</div>
